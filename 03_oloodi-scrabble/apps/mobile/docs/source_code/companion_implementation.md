# Source Code Documentation
\n## Project Structure\n
\n### firebase_options.dart\n
```dart
// File generated by FlutterFire CLI.
// ignore_for_file: type=lint
import 'package:firebase_core/firebase_core.dart' show FirebaseOptions;
import 'package:flutter/foundation.dart'
    show defaultTargetPlatform, kIsWeb, TargetPlatform;

/// Default [FirebaseOptions] for use with your Firebase apps.
///
/// Example:
/// ```dart
/// import 'firebase_options.dart';
/// // ...
/// await Firebase.initializeApp(
///   options: DefaultFirebaseOptions.currentPlatform,
/// );
/// ```
class DefaultFirebaseOptions {
  static FirebaseOptions get currentPlatform {
    if (kIsWeb) {
      return web;
    }
    switch (defaultTargetPlatform) {
      case TargetPlatform.android:
        throw UnsupportedError(
          'DefaultFirebaseOptions have not been configured for android - '
          'you can reconfigure this by running the FlutterFire CLI again.',
        );
      case TargetPlatform.iOS:
        throw UnsupportedError(
          'DefaultFirebaseOptions have not been configured for ios - '
          'you can reconfigure this by running the FlutterFire CLI again.',
        );
      case TargetPlatform.macOS:
        throw UnsupportedError(
          'DefaultFirebaseOptions have not been configured for macos - '
          'you can reconfigure this by running the FlutterFire CLI again.',
        );
      case TargetPlatform.windows:
        throw UnsupportedError(
          'DefaultFirebaseOptions have not been configured for windows - '
          'you can reconfigure this by running the FlutterFire CLI again.',
        );
      case TargetPlatform.linux:
        throw UnsupportedError(
          'DefaultFirebaseOptions have not been configured for linux - '
          'you can reconfigure this by running the FlutterFire CLI again.',
        );
      default:
        throw UnsupportedError(
          'DefaultFirebaseOptions are not supported for this platform.',
        );
    }
  }

  static const FirebaseOptions web = FirebaseOptions(
    apiKey: 'AIzaSyA1mSVhEByfd3i4-MVHI5O48s8QsqORXj8',
    appId: '1:553140087820:web:c6db42b98856c306d51229',
    messagingSenderId: '553140087820',
    projectId: 'learning-box-369917',
    authDomain: 'learning-box-369917.firebaseapp.com',
    storageBucket: 'learning-box-369917.firebasestorage.app',
    measurementId: 'G-KX4ZKD5MPR',
  );
}
```\n
\n### main.dart\n
```dart
// lib/main.dart
import 'package:flutter/material.dart';
import 'package:flutter_dotenv/flutter_dotenv.dart';
import 'package:oloodi_scrabble_end_user_app/src/screens/game_sessions_list_screen.dart';
import 'package:oloodi_scrabble_end_user_app/src/themes/app_themes.dart';
import 'package:provider/provider.dart';
import 'package:oloodi_scrabble_end_user_app/src/providers/game_state_provider.dart';
import 'package:firebase_core/firebase_core.dart';
import 'firebase_options.dart';

void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  await Firebase.initializeApp(
    options: DefaultFirebaseOptions.currentPlatform,
  );
    // Make sure to add this line
  await dotenv.load(fileName: ".env");
  runApp(const ScrabbleAIApp());
}

class ScrabbleAIApp extends StatelessWidget {
  const ScrabbleAIApp({super.key});

  @override
  Widget build(BuildContext context) {
    return MultiProvider(
      providers: [
        ChangeNotifierProvider(create: (_) => GameStateProvider()),
      ],
      child: MaterialApp(
        title: 'Oloodi Scrabble Companion',
        theme: AppTheme.theme,
        debugShowCheckedModeBanner: false,
        home: const GameSessionsListScreen(),
      ),
    );
  }
}
```\n
\n### src/providers/game_state_provider.dart\n
```dart
// lib/src/providers/game_state_provider.dart
import 'dart:async';
import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:flutter/material.dart';
import 'package:oloodi_scrabble_end_user_app/src/models/move_explanation.dart';
import 'package:oloodi_scrabble_end_user_app/src/service/ai_service.dart';
import '../models/game_session.dart';
import '../models/board_square.dart';
import '../models/move.dart';
import '../models/tile.dart';
import '../models/player.dart';
import '../service/firebase_service.dart';

class GameStateProvider with ChangeNotifier {
  final FirebaseService _firebaseService = FirebaseService();
  final AIService _aiService = AIService();
  Map<String, MoveExplanation> _moveExplanations = {};

  bool _showAudioControls = false;
  MoveExplanation? _currentExplanation;

  // Game state
  List<List<BoardSquare>> _board = [];
  List<Move> _moves = [];
  List<Player> _players = [];
  String? _currentPlayerId;
  bool _isGameOver = false;
  String? _gameId;

  // Subscriptions
  StreamSubscription? _gameSubscription;
  StreamSubscription? _movesSubscription;

  // Constructor
  GameStateProvider() {
    _initializeBoard();
  }

  // Add getters
  bool get showAudioControls => _showAudioControls;
  MoveExplanation? get currentExplanation => _currentExplanation;

String getPlayerNameById(String playerId) {
  return _players.firstWhere(
    (player) => player.id == playerId,
    orElse: () => Player(
      id: playerId,
      displayName: 'Unknown Player',
      color: Colors.grey,
      imagePath: '',
    ),
  ).displayName;
}

  void toggleAudioControls(MoveExplanation? explanation) {
    _showAudioControls = explanation != null;
    _currentExplanation = explanation;
    notifyListeners();
  }

  // Add these methods
  Future<MoveExplanation> explainMove(Move move) async {
    // Check if we already have an explanation
    if (_moveExplanations.containsKey(move.word)) {
      return _moveExplanations[move.word]!;
    }

    try {
      final currentScore = getPlayerScore(move.playerId);
      final playerName = getPlayerNameById(move.playerId);
      final explanation = await _aiService.generateMoveExplanation(
        playerName,
        move,
        currentScore,
      );

      // Convert to speech in parallel
      final audioData = await _aiService.convertToSpeech(explanation);

      final moveExplanation = MoveExplanation(
        text: explanation,
        audioData: audioData,
      );

      _moveExplanations[move.word] = moveExplanation;
      notifyListeners();

      return moveExplanation;
    } catch (e) {
      throw Exception('Failed to explain move: $e');
    }
  }

  MoveExplanation? getExplanation(String word) => _moveExplanations[word];

  // Get available game sessions
  Stream<List<GameSession>> getAvailableSessions() {
    return _firebaseService.getActiveSessions().map((snapshot) =>
        snapshot.docs.map((doc) => GameSession.fromFirestore(doc)).toList());
  }

  // Initialize game with session ID
  Future<void> initializeGame(String gameId) async {
    try {
      _gameId = gameId;
      _initializeBoard();
      _moves.clear();

      // Listen to game document updates
      _gameSubscription =
          _firebaseService.listenToGame(gameId).listen((snapshot) {
        final gameData = snapshot.data() as Map<String, dynamic>;
        _updateGameInfo(gameData);
      });

      // Listen to moves collection
      _movesSubscription =
          _firebaseService.listenToMoves(gameId).listen((snapshot) {
        _handleMovesUpdate(snapshot);
      });

      notifyListeners();
    } catch (e) {
      print('Error initializing game: $e');
      rethrow;
    }
  }

  // Handle moves updates
  void _handleMovesUpdate(QuerySnapshot snapshot) {
    // Handle deletions or out-of-order moves
    if (snapshot.docChanges.any((change) =>
        change.type == DocumentChangeType.removed ||
        change.type == DocumentChangeType.modified)) {
      _rebuildBoardState(snapshot.docs);
    } else {
      // Handle only new moves
      for (var change in snapshot.docChanges) {
        if (change.type == DocumentChangeType.added) {
          final move = Move.fromFirestore(change.doc);
          _addMove(move);
        }
      }
    }
  }

  // Rebuild entire board state
  void _rebuildBoardState(List<QueryDocumentSnapshot> docs) {
    _initializeBoard();
    _moves.clear();

    // Reapply all moves in order
    for (var doc in docs) {
      final move = Move.fromFirestore(doc);
      _addMove(move);
    }
  }

  // Manual board update (fallback method)
  Future<void> updateBoard() async {
    if (_gameId == null) throw Exception('No active game session');

    try {
      final movesSnapshot = await _firebaseService.getAllMoves(_gameId!);
      _rebuildBoardState(movesSnapshot.docs);
    } catch (e) {
      print('Error updating board: $e');
      rethrow;
    }
  }

  // Get session statistics
  Future<Map<String, dynamic>> getSessionStats(String sessionId) async {
    return _firebaseService.getSessionStats(sessionId);
  }

  // Get moves for a specific player
  List<Move> getMovesByPlayer(String playerId) {
    return _moves.where((move) => move.playerId == playerId).toList();
  }

  // Calculate score for a specific player
  int getPlayerScore(String playerId) {
    return _moves
        .where((move) => move.playerId == playerId)
        .fold(0, (sum, move) => sum + move.score);
  }

  // Calculate remaining letters based on played moves
  Map<String, int> get letterDistribution {
    Map<String, int> remaining = Map.from(_initialLetterDistribution);

    for (var move in _moves) {
      for (var tile in move.tiles) {
        if (remaining.containsKey(tile.letter)) {
          remaining[tile.letter] = remaining[tile.letter]! - 1;
        }
      }
    }

    return remaining;
  }

  // Get total remaining letters
  int get remainingLetters {
    return letterDistribution.values.fold(0, (sum, count) => sum + count);
  }

  // Initialize empty board
  void _initializeBoard() {
    _board = List.generate(15, (row) {
      return List.generate(15, (col) {
        return BoardSquare(
          row: row,
          col: col,
          type: _getSquareType(row, col),
        );
      });
    });
    notifyListeners();
  }

  // Update game information
  void _updateGameInfo(Map<String, dynamic> gameData) {
    _players = [
      Player(
        id: 'p1',
        displayName: gameData['player1Name'],
        color: Colors.blue[300]!,
        imagePath: gameData['player1Image'] ?? '',
      ),
      Player(
        id: 'p2',
        displayName: gameData['player2Name'],
        color: Colors.green[300]!,
        imagePath: gameData['player2Image'] ?? '',
      ),
    ];

    _currentPlayerId = gameData['currentPlayerId'];
    _isGameOver = gameData['isGameOver'] ?? false;

    notifyListeners();
  }

// Helper method to add moves
  void _addMove(Move move) {
    _moves.add(move);

    // Store existing tiles before placing new ones
    Map<String, Tile> existingTiles = {};
    for (int row = 0; row < 15; row++) {
      for (int col = 0; col < 15; col++) {
        if (_board[row][col].tile != null) {
          String key = '${row}-${col}';
          existingTiles[key] = _board[row][col].tile!;
        }
      }
    }

    // Place new tiles
    for (var tile in move.tiles) {
      String key = '${tile.row}-${tile.col}';
      _board[tile.row][tile.col].tile = Tile(
        letter: tile.letter,
        points: tile.points,
        playerId: move.playerId,
        isNew: true,
      );
      // Remove from existing tiles if we just overwrote it
      existingTiles.remove(key);
    }

    // Restore existing tiles that weren't overwritten
    existingTiles.forEach((key, tile) {
      final coords = key.split('-');
      final row = int.parse(coords[0]);
      final col = int.parse(coords[1]);
      if (_board[row][col].tile == null) {
        _board[row][col].tile = tile;
      }
    });

    notifyListeners();

    // Reset the "new" flag after animation
    Future.delayed(const Duration(milliseconds: 800), () {
      for (var tile in move.tiles) {
        if (_board[tile.row][tile.col].tile != null) {
          _board[tile.row][tile.col].tile!.isNew = false;
        }
      }
      notifyListeners();
    });
  }

  // Get square type for board initialization
  SquareType _getSquareType(int row, int col) {
    // Center square
    if (row == 7 && col == 7) {
      return SquareType.doubleWord;
    }

    // Triple Word Score
    if ((row == 0 || row == 14) && (col == 0 || col == 7 || col == 14) ||
        (row == 7 && (col == 0 || col == 14))) {
      return SquareType.tripleWord;
    }

    // Double Word Score
    if (row == col || row + col == 14) {
      if (row >= 1 && row <= 5 || row >= 9 && row <= 13) {
        return SquareType.doubleWord;
      }
    }

    // Triple Letter Score
    if ((row == 1 || row == 13) && (col == 5 || col == 9) ||
        (row == 5 || row == 9) &&
            (col == 1 || col == 5 || col == 9 || col == 13)) {
      return SquareType.tripleLetter;
    }

    // Double Letter Score
    if ((row == 3 || row == 11) && (col == 0 || col == 7 || col == 14) ||
        (row == 6 || row == 8) &&
            (col == 2 || col == 6 || col == 8 || col == 12) ||
        (row == 0 || row == 7 || col == 14) && (col == 3 || col == 11)) {
      return SquareType.doubleLetter;
    }

    return SquareType.normal;
  }

  // Letter distribution constants (French Scrabble distribution)
  static const Map<String, int> _initialLetterDistribution = {
    'A': 9,
    'B': 2,
    'C': 2,
    'D': 3,
    'E': 15,
    'F': 2,
    'G': 2,
    'H': 2,
    'I': 8,
    'J': 1,
    'K': 1,
    'L': 5,
    'M': 3,
    'N': 6,
    'O': 6,
    'P': 2,
    'Q': 1,
    'R': 6,
    'S': 6,
    'T': 6,
    'U': 6,
    'V': 2,
    'W': 1,
    'X': 1,
    'Y': 1,
    'Z': 1,
    '*': 2, // Blank tiles
  };

  // Getters
  List<List<BoardSquare>> get board => _board;
  List<Move> get moves => _moves;
  List<Player> get players => _players;
  String? get currentPlayerId => _currentPlayerId;
  bool get isGameOver => _isGameOver;
  Move? get lastMove => _moves.isNotEmpty ? _moves.last : null;

  @override
  void dispose() {
    _gameSubscription?.cancel();
    _movesSubscription?.cancel();
    super.dispose();
  }
}
```\n
\n### src/models/tile.dart\n
```dart
class Tile {
  final String letter;
  final int points;
  final String playerId;
  bool isNew;

  Tile({
    required this.letter,
    required this.points,
    required this.playerId,
    this.isNew = false,
  });
}
```\n
\n### src/models/move_explanation.dart\n
```dart
class MoveExplanation {
  final String text;
  final List<int>? audioData;
  final DateTime timestamp;

  MoveExplanation({
    required this.text,
    this.audioData,
    DateTime? timestamp,
  }) : timestamp = timestamp ?? DateTime.now();
}```\n
\n### src/models/game_session.dart\n
```dart
// lib/src/models/game_session.dart
import 'package:cloud_firestore/cloud_firestore.dart';

class GameSession {
  final String id;
  final String player1Name;
  final String player2Name;
  final DateTime startTime;
  final String currentPlayerId;
  final bool isActive;

  const GameSession({
    required this.id,
    required this.player1Name,
    required this.player2Name,
    required this.startTime,
    this.currentPlayerId = 'p1',
    this.isActive = true,
  });

  factory GameSession.fromFirestore(DocumentSnapshot doc) {
    final data = doc.data() as Map<String, dynamic>;
    return GameSession(
      id: doc.id,
      player1Name: data['player1Name'] ?? '',
      player2Name: data['player2Name'] ?? '',
      startTime: (data['startTime'] as Timestamp).toDate(),
      currentPlayerId: data['currentPlayerId'] ?? 'p1',
      isActive: data['isActive'] ?? false,
    );
  }

  String getCurrentPlayerName() {
    return currentPlayerId == 'p1' ? player1Name : player2Name;
  }

  String getNextPlayerId() => currentPlayerId == 'p1' ? 'p2' : 'p1';
}```\n
\n### src/models/move.g.dart\n
```dart
// GENERATED CODE - DO NOT MODIFY BY HAND

part of 'move.dart';

// **************************************************************************
// JsonSerializableGenerator
// **************************************************************************

Move _$MoveFromJson(Map<String, dynamic> json) => Move(
      word: json['word'] as String,
      score: (json['score'] as num).toInt(),
      tiles: (json['tiles'] as List<dynamic>)
          .map((e) => PlacedTile.fromJson(e as Map<String, dynamic>))
          .toList(),
      playerId: json['playerId'] as String,
      timestamp: DateTime.parse(json['timestamp'] as String),
    );

Map<String, dynamic> _$MoveToJson(Move instance) => <String, dynamic>{
      'word': instance.word,
      'score': instance.score,
      'tiles': instance.tiles,
      'playerId': instance.playerId,
      'timestamp': instance.timestamp.toIso8601String(),
    };

PlacedTile _$PlacedTileFromJson(Map<String, dynamic> json) => PlacedTile(
      letter: json['letter'] as String,
      row: (json['row'] as num).toInt(),
      col: (json['col'] as num).toInt(),
      points: (json['points'] as num).toInt(),
    );

Map<String, dynamic> _$PlacedTileToJson(PlacedTile instance) =>
    <String, dynamic>{
      'letter': instance.letter,
      'row': instance.row,
      'col': instance.col,
      'points': instance.points,
    };
```\n
\n### src/models/player.dart\n
```dart
import 'package:flutter/material.dart';

extension PlayerListExtension on List<Player> {
  String getDisplayNameById(String playerId) {
    return firstWhere(
      (player) => player.id == playerId,
      orElse: () => Player(
        id: playerId,
        displayName: 'Unknown Player',
        color: Colors.grey,
        imagePath: '',
      ),
    ).displayName;
  }
}

class Player {
  final String id;
  final String displayName;
  final Color color;
  final String imagePath;

  const Player({
    required this.id,
    required this.displayName,
    required this.color,
    required this.imagePath,
  });
}
```\n
\n### src/models/board.dart\n
```dart
import 'package:oloodi_scrabble_end_user_app/src/models/tile.dart';

class Board {
  static const int boardSize = 15;
  final List<List<Tile?>> tiles;
  
  Board() : tiles = List.generate(
    boardSize,
    (_) => List.generate(boardSize, (_) => null)
  );
  
  bool isValidPlacement(int row, int col) {
    if (row < 0 || row >= boardSize || col < 0 || col >= boardSize) {
      return false;
    }
    return tiles[row][col] == null;
  }
  
  // Additional board logic will go here
}```\n
\n### src/models/board_square.dart\n
```dart
import 'package:flutter/material.dart';
import 'package:oloodi_scrabble_end_user_app/src/models/tile.dart';

class BoardSquare {
  final int row;
  final int col;
  final SquareType type;
  Tile? tile;

  BoardSquare({
    required this.row,
    required this.col,
    required this.type,
    this.tile,
  });
}

// Add this to your models/board_square.dart or where your SquareType enum is defined
enum SquareType {
  normal,
  doubleLetter, // Light blue - DL
  tripleLetter, // Dark blue - TL
  doubleWord, // Pink - DW
  tripleWord, // Red - TW
  center // Center square (acts as DW)
}

// Add this method to MockGameService
SquareType getBoardSquareType(int row, int col) {
  // Center square
  if (row == 7 && col == 7) {
    return SquareType.center;
  }

  // Triple Word Score (Red)
  if ((row == 0 || row == 14) &&
          (col == 0 || col == 7 || col == 14) || // Corners and middle edges
      (row == 7 && (col == 0 || col == 14))) {
    // Middle row edges
    return SquareType.tripleWord;
  }

  // Double Word Score (Pink)
  if (row == col || row + col == 14) {
    // Diagonals
    if (row >= 1 && row <= 5 || row >= 9 && row <= 13) {
      // Excluding center and edges
      return SquareType.doubleWord;
    }
  }

  // Triple Letter Score (Dark Blue)
  if ((row == 1 || row == 13) && (col == 5 || col == 9) || // Near top/bottom
      (row == 5 || row == 9) &&
          (col == 1 || col == 5 || col == 9 || col == 13)) {
    // Middle area
    return SquareType.tripleLetter;
  }

  // Double Letter Score (Light Blue)
  if ((row == 3 || row == 11) &&
          (col == 0 || col == 7 || col == 14) || // Top/bottom edges
      (row == 6 || row == 8) &&
          (col == 2 || col == 6 || col == 8 || col == 12) || // Middle area
      (row == 0 || row == 7 || row == 14) &&
          (col == 3 || col == 11) || // Left/right edges
      (row == 2 || row == 12) && (col == 6 || col == 8)) {
    // Additional DL squares
    return SquareType.doubleLetter;
  }

  // Normal square
  return SquareType.normal;
}

// Optional: Helper method to get a description of the square
String getSquareDescription(SquareType type) {
  switch (type) {
    case SquareType.normal:
      return '';
    case SquareType.doubleLetter:
      return 'DL';
    case SquareType.tripleLetter:
      return 'TL';
    case SquareType.doubleWord:
      return 'DW';
    case SquareType.tripleWord:
      return 'TW';
    case SquareType.center:
      return '★';
  }
}

// Optional: Helper method to get square color
Color getSquareColor(SquareType type) {
  switch (type) {
    case SquareType.normal:
      return Colors.white;
    case SquareType.doubleLetter:
      return Colors.lightBlue[50]!; // Light blue
    case SquareType.tripleLetter:
      return Colors.blue[100]!; // Dark blue
    case SquareType.doubleWord:
      return Colors.pink[50]!; // Pink
    case SquareType.tripleWord:
      return Colors.red[100]!; // Red
    case SquareType.center:
      return Colors.pink[50]!; // Same as DW
  }
}
```\n
\n### src/models/move.dart\n
```dart
// lib/src/models/move.dart
import 'package:json_annotation/json_annotation.dart';
import 'package:cloud_firestore/cloud_firestore.dart';

part 'move.g.dart';

@JsonSerializable()
class Move {
  final String word;
  final int score;
  final List<PlacedTile> tiles;
  final String playerId;
  final DateTime timestamp;

  Move({
    required this.word,
    required this.score,
    required this.tiles,
    required this.playerId,
    required this.timestamp,
  });

  factory Move.fromJson(Map<String, dynamic> json) => _$MoveFromJson(json);
  
  factory Move.fromFirestore(DocumentSnapshot doc) {
    final data = doc.data() as Map<String, dynamic>;
    return Move(
      word: data['word'] ?? '',
      score: data['score'] ?? 0,
      tiles: (data['tiles'] as List<dynamic>?)
          ?.map((tile) => PlacedTile(
                letter: tile['letter'],
                row: tile['row'],
                col: tile['col'],
                points: tile['points'],
              ))
          .toList() ?? [],
      playerId: data['playerId'] ?? '',
      timestamp: (data['timestamp'] as Timestamp).toDate(),
    );
  }

  Map<String, dynamic> toJson() => _$MoveToJson(this);
}

@JsonSerializable()
class PlacedTile {
  final String letter;
  final int row;
  final int col;
  final int points;

  PlacedTile({
    required this.letter,
    required this.row,
    required this.col,
    required this.points,
  });

  factory PlacedTile.fromJson(Map<String, dynamic> json) => _$PlacedTileFromJson(json);
  Map<String, dynamic> toJson() => _$PlacedTileToJson(this);
}```\n
\n### src/screens/game_sessions_list_screen.dart\n
```dart
// lib/src/screens/game_sessions_list_screen.dart
import 'package:flutter/material.dart';
import 'package:provider/provider.dart';
import 'package:intl/intl.dart';
import '../providers/game_state_provider.dart';
import '../models/game_session.dart';
import 'home_screen.dart';

class GameSessionsListScreen extends StatelessWidget {
  const GameSessionsListScreen({super.key});

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: const Text('Available Games'),
      ),
      body: StreamBuilder<List<GameSession>>(
        stream: context.read<GameStateProvider>().getAvailableSessions(),
        builder: (context, snapshot) {
          if (snapshot.hasError) {
            return Center(
              child: Text('Error: ${snapshot.error}'),
            );
          }

          if (snapshot.connectionState == ConnectionState.waiting) {
            return const Center(
              child: CircularProgressIndicator(),
            );
          }

          final sessions = snapshot.data ?? [];
          if (sessions.isEmpty) {
            return Center(
              child: Column(
                mainAxisAlignment: MainAxisAlignment.center,
                children: [
                  const Icon(Icons.sports_esports_outlined, size: 64, color: Colors.grey),
                  const SizedBox(height: 16),
                  const Text(
                    'No active game sessions',
                    style: TextStyle(fontSize: 18, color: Colors.grey),
                  ),
                  const SizedBox(height: 8),
                  const Text(
                    'Wait for a moderator to start a game',
                    style: TextStyle(color: Colors.grey),
                  ),
                ],
              ),
            );
          }

          return ListView.builder(
            itemCount: sessions.length,
            itemBuilder: (context, index) {
              final session = sessions[index];
              return _buildSessionCard(context, session);
            },
          );
        },
      ),
    );
  }

  Widget _buildSessionCard(BuildContext context, GameSession session) {
    final dateFormat = DateFormat('MMM d, y – h:mm a');

    return Card(
      margin: const EdgeInsets.symmetric(horizontal: 16, vertical: 8),
      child: InkWell(
        onTap: () => _joinSession(context, session),
        child: Container(
          padding: const EdgeInsets.all(16),
          child: Column(
            crossAxisAlignment: CrossAxisAlignment.start,
            children: [
              Row(
                children: [
                  Expanded(
                    child: Column(
                      crossAxisAlignment: CrossAxisAlignment.start,
                      children: [
                        Row(
                          children: [
                            Text(
                              '${session.player1Name} vs ${session.player2Name}',
                              style: const TextStyle(
                                fontSize: 16,
                                fontWeight: FontWeight.bold,
                              ),
                            ),
                            if (session.isActive)
                              Container(
                                margin: const EdgeInsets.only(left: 8),
                                padding: const EdgeInsets.symmetric(
                                  horizontal: 8,
                                  vertical: 2,
                                ),
                                decoration: BoxDecoration(
                                  color: Colors.green,
                                  borderRadius: BorderRadius.circular(12),
                                ),
                                child: const Text(
                                  'Live',
                                  style: TextStyle(
                                    color: Colors.white,
                                    fontSize: 12,
                                  ),
                                ),
                              ),
                          ],
                        ),
                        const SizedBox(height: 4),
                        Text(
                          dateFormat.format(session.startTime),
                          style: TextStyle(
                            color: Colors.grey[600],
                            fontSize: 12,
                          ),
                        ),
                      ],
                    ),
                  ),
                  const Icon(Icons.chevron_right, color: Colors.grey),
                ],
              ),
              if (session.isActive) ...[
                const SizedBox(height: 16),
                _buildGameStats(context, session),
              ],
            ],
          ),
        ),
      ),
    );
  }

  Widget _buildGameStats(BuildContext context, GameSession session) {
    return FutureBuilder<Map<String, dynamic>>(
      future: context.read<GameStateProvider>().getSessionStats(session.id),
      builder: (context, snapshot) {
        if (!snapshot.hasData) {
          return const SizedBox();
        }

        final stats = snapshot.data!;
        return Row(
          mainAxisAlignment: MainAxisAlignment.spaceAround,
          children: [
            _buildStatItem('Moves', stats['totalMoves']?.toString() ?? '0'),
            _buildStatItem('Letters Remaining', stats['remainingLetters']?.toString() ?? '-'),
            _buildStatItem('Duration', _formatDuration(session.startTime)),
          ],
        );
      },
    );
  }

  Widget _buildStatItem(String label, String value) {
    return Column(
      children: [
        Text(
          value,
          style: const TextStyle(
            fontSize: 16,
            fontWeight: FontWeight.bold,
          ),
        ),
        Text(
          label,
          style: TextStyle(
            fontSize: 12,
            color: Colors.grey[600],
          ),
        ),
      ],
    );
  }

  String _formatDuration(DateTime startTime) {
    final duration = DateTime.now().difference(startTime);
    final hours = duration.inHours;
    final minutes = duration.inMinutes % 60;
    return '${hours}h ${minutes}m';
  }

  void _joinSession(BuildContext context, GameSession session) async {
    try {
      await context.read<GameStateProvider>().initializeGame(session.id);
      
      if (context.mounted) {
        Navigator.pushReplacement(
          context,
          MaterialPageRoute(
            builder: (context) => const HomeScreen(),
          ),
        );
      }
    } catch (e) {
      if (context.mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(content: Text('Error joining session: $e')),
        );
      }
    }
  }
}```\n
\n### src/screens/home_screen.dart\n
```dart
import 'package:flutter/material.dart';
import 'package:oloodi_scrabble_end_user_app/src/models/move.dart';
import 'package:oloodi_scrabble_end_user_app/src/providers/game_state_provider.dart';
import 'package:oloodi_scrabble_end_user_app/src/themes/app_themes.dart';
import 'package:oloodi_scrabble_end_user_app/src/widgets/board_widget.dart';
import 'package:oloodi_scrabble_end_user_app/src/widgets/move_explanation_controls.dart';
import 'package:oloodi_scrabble_end_user_app/src/widgets/player_score_card.dart';
import 'package:provider/provider.dart';

import '../widgets/move_history_panel.dart';

class HomeScreen extends StatefulWidget {
  const HomeScreen({super.key});

  @override
  State<HomeScreen> createState() => _HomeScreenState();
}

class _HomeScreenState extends State<HomeScreen> {
  bool _showHistory = false;
  bool _showChat = false;

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: Row(
        children: [
          // Left Sidebar
          Container(
            width: 250,
            decoration: BoxDecoration(
              color: AppTheme.primaryColor,
              boxShadow: [
                BoxShadow(
                  color: Colors.black.withOpacity(0.1),
                  blurRadius: 5,
                  offset: const Offset(3, 0),
                ),
              ],
            ),
            child: Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                // App Title
                Padding(
                  padding: const EdgeInsets.all(16.0),
                  child: Row(
                    children: [
                      Image.asset(
                        'assets/images/app_icon.png', // Add your app icon
                        width: 32,
                        height: 32,
                        errorBuilder: (context, error, stackTrace) =>
                            const Icon(
                          Icons.sports_esports,
                          size: 32,
                          color: Colors.white,
                        ),
                      ),
                      const SizedBox(width: 12),
                      const Text(
                        'Oloodi Scrabble\nAI Companion',
                        style: TextStyle(
                          color: Colors.white,
                          fontSize: 20,
                          fontWeight: FontWeight.bold,
                          height: 1.2,
                        ),
                      ),
                    ],
                  ),
                ),
                const Divider(color: Colors.white24),

                // Player Cards
                Padding(
                  padding: const EdgeInsets.symmetric(horizontal: 16.0),
                  child: _buildPlayerCards(),
                ),

                const Spacer(),

                // Action Buttons
                _buildActionButtons(),

                const SizedBox(height: 16),
              ],
            ),
          ),

          // Main Content Area
          Expanded(
            child: Stack(
              children: [
                // Board
                const Center(
                  child: BoardWidget(),
                ),

                // Move History Panel
                if (_showHistory)
                  Positioned(
                    right: 0,
                    top: 0,
                    bottom: 0,
                    width: 300,
                    child: Card(
                      margin: EdgeInsets.zero,
                      shape: const RoundedRectangleBorder(
                        borderRadius:
                            BorderRadius.horizontal(left: Radius.circular(12)),
                      ),
                      child: const MoveHistoryPanel(),
                    ),
                  ),

                // Chat Overlay
                if (_showChat) _buildChatOverlay(),
              ],
            ),
          ),
        ],
      ),
    );
  }

  Widget _buildPlayerCards() {
    return Consumer<GameStateProvider>(
      builder: (context, gameState, child) {
        return Column(
          children: [
            for (final player in gameState.players) ...[
              PlayerScoreCard(
                player: player,
                score: gameState.getPlayerScore(player.id),
                isCurrentPlayer: player.id == gameState.currentPlayerId,
              ),
              const SizedBox(height: 12),
            ],
          ],
        );
      },
    );
  }

  Widget _buildActionButtons() {
    return Consumer<GameStateProvider>(
      builder: (context, gameState, child) {
        return Column(
          crossAxisAlignment: CrossAxisAlignment.stretch,
          children: [
            const Divider(color: Colors.white24),
            _buildActionButton(
                icon: Icons.refresh,
                label: 'Refresh Board',
                onPressed: gameState.isGameOver
                    ? null
                    : () async {
                        try {
                          await gameState.updateBoard();
                          if (mounted) {
                            ScaffoldMessenger.of(context).showSnackBar(
                              const SnackBar(
                                content: Text('Board refreshed successfully'),
                                duration: Duration(seconds: 2),
                              ),
                            );
                          }
                        } catch (e) {
                          if (mounted) {
                            ScaffoldMessenger.of(context).showSnackBar(
                              SnackBar(
                                content: Text('Error refreshing board: $e'),
                                backgroundColor: Colors.red,
                              ),
                            );
                          }
                        }
                      }),
            _buildActionButton(
              icon: _showHistory ? Icons.history_toggle_off : Icons.history,
              label: 'Move History',
              isActive: _showHistory,
              onPressed: () {
                setState(() {
                  _showHistory = !_showHistory;
                });
              },
            ),
            _buildActionButton(
              icon: _showChat ? Icons.chat_bubble : Icons.chat_bubble_outline,
              label: 'Chat',
              isActive: _showChat,
              onPressed: () {
                setState(() {
                  _showChat = !_showChat;
                });
              },
            ),
            _buildActionButton(
              icon: Icons.lightbulb_outline,
              label: 'Explain Last Move',
              onPressed: gameState.lastMove != null
                  ? () => _handleExplainLastMove(gameState)
                  : null,
            ),
            if (gameState.showAudioControls &&
                gameState.currentExplanation != null)
              MoveExplanationControls(
                explanation: gameState.currentExplanation!,
                onClose: () => gameState.toggleAudioControls(null),
              ),
          ],
        );
      },
    );
  }

  Widget _buildActionButton({
    required IconData icon,
    required String label,
    required VoidCallback? onPressed,
    bool isActive = false,
  }) {
    return Padding(
      padding: const EdgeInsets.symmetric(horizontal: 16.0, vertical: 4.0),
      child: TextButton.icon(
        icon: Icon(
          icon,
          color: isActive ? AppTheme.accentColor : Colors.white,
        ),
        label: Text(
          label,
          style: TextStyle(
            color: isActive ? AppTheme.accentColor : Colors.white,
          ),
        ),
        onPressed: onPressed,
        style: TextButton.styleFrom(
          alignment: Alignment.centerLeft,
          padding: const EdgeInsets.symmetric(
            horizontal: 12,
            vertical: 16,
          ),
        ),
      ),
    );
  }

  Widget _buildChatOverlay() {
    return Positioned(
      right: 16,
      bottom: 16,
      width: 300,
      height: 400,
      child: Card(
        elevation: 8,
        shape: RoundedRectangleBorder(
          borderRadius: BorderRadius.circular(12),
        ),
        child: Column(
          children: [
            // Chat header
            Container(
              padding: const EdgeInsets.all(8),
              decoration: BoxDecoration(
                color: AppTheme.primaryColor,
                borderRadius: const BorderRadius.vertical(
                  top: Radius.circular(12),
                ),
              ),
              child: Row(
                mainAxisAlignment: MainAxisAlignment.spaceBetween,
                children: [
                  const Text(
                    'Game Assistant',
                    style: TextStyle(
                      color: Colors.white,
                      fontWeight: FontWeight.bold,
                    ),
                  ),
                  IconButton(
                    icon: const Icon(Icons.close, color: Colors.white),
                    onPressed: () {
                      setState(() {
                        _showChat = false;
                      });
                    },
                  ),
                ],
              ),
            ),
            // Chat messages area
            const Expanded(
              child: Padding(
                padding: EdgeInsets.all(8.0),
                child: Center(
                  child: Text('Chat functionality coming soon...'),
                ),
              ),
            ),
            // Input area
            Padding(
              padding: const EdgeInsets.all(8.0),
              child: Row(
                children: [
                  IconButton(
                    icon: const Icon(Icons.mic),
                    onPressed: () {
                      // Implement voice input
                    },
                  ),
                  const Expanded(
                    child: TextField(
                      decoration: InputDecoration(
                        hintText: 'Type your message...',
                        border: OutlineInputBorder(),
                        contentPadding: EdgeInsets.symmetric(
                          horizontal: 12,
                          vertical: 8,
                        ),
                      ),
                    ),
                  ),
                  IconButton(
                    icon: const Icon(Icons.send),
                    onPressed: () {
                      // Send message
                    },
                  ),
                ],
              ),
            ),
          ],
        ),
      ),
    );
  }

  Future<void> _handleExplainLastMove(GameStateProvider gameState) async {
    if (gameState.lastMove == null) return;

    try {
      final explanation = await gameState.explainMove(gameState.lastMove!);
      if (mounted) {
        gameState.toggleAudioControls(explanation);
      }
    } catch (e) {
      if (mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(
            content: Text('Error generating explanation: $e'),
            backgroundColor: Colors.red,
          ),
        );
      }
    }
  }
}
```\n
\n### src/service/camera_service.dart\n
```dart
import 'package:camera/camera.dart';
import 'package:path_provider/path_provider.dart';

class CameraService {
  CameraController? _controller;
  bool _isInitialized = false;

  Future<void> initialize() async {
    final cameras = await availableCameras();
    if (cameras.isEmpty) throw Exception('No cameras available');
    
    _controller = CameraController(
      cameras.first,
      ResolutionPreset.high,
      enableAudio: false,
    );

    await _controller!.initialize();
    _isInitialized = true;
  }

  Future<String> captureImage() async {
    if (!_isInitialized) throw Exception('Camera not initialized');
    
    final XFile image = await _controller!.takePicture();
    final directory = await getTemporaryDirectory();
    final String filePath = '${directory.path}/${DateTime.now().toIso8601String()}.jpg';
    
    await image.saveTo(filePath);
    return filePath;
  }

  void dispose() {
    _controller?.dispose();
    _isInitialized = false;
  }

  bool get isInitialized => _isInitialized;
  CameraController? get controller => _controller;
}```\n
\n### src/service/firebase_service.dart\n
```dart
// lib/src/services/firebase_service.dart
import 'package:cloud_firestore/cloud_firestore.dart';
import '../models/game_session.dart';
import '../models/player.dart';
import 'package:flutter/material.dart';

class FirebaseService {
  final FirebaseFirestore _firestore = FirebaseFirestore.instanceFor(
    app: FirebaseFirestore.instance.app,
    databaseId: "scrabble",
  );
  String? _gameId;

  // Get active game sessions
  Stream<QuerySnapshot> getActiveSessions() {
    return _firestore
        .collection('game_sessions')
        .where('isActive', isEqualTo: true)
        .orderBy('startTime', descending: true)
        .snapshots();
  }

  // Listen to specific game session
  Stream<DocumentSnapshot> listenToGame(String gameId) {
    _gameId = gameId;
    return _firestore.collection('game_sessions').doc(gameId).snapshots();
  }

  // Listen to moves for a specific game
  Stream<QuerySnapshot> listenToMoves(String gameId) {
    return _firestore
        .collection('game_sessions')
        .doc(gameId)
        .collection('moves')
        .orderBy('timestamp', descending: false)
        .snapshots();
  }

  // Get all moves for a game
  Future<QuerySnapshot> getAllMoves(String gameId) async {
    return await _firestore
        .collection('game_sessions')
        .doc(gameId)
        .collection('moves')
        .orderBy('timestamp', descending: false)
        .get();
  }

  // Get players for a specific game
  Future<List<Player>> getPlayers(String gameId) async {
    final gameDoc =
        await _firestore.collection('game_sessions').doc(gameId).get();

    if (!gameDoc.exists) {
      throw Exception('Game not found');
    }

    final data = gameDoc.data() as Map<String, dynamic>;

    return [
      Player(
        id: 'p1',
        displayName: data['player1Name'] ?? 'Player 1',
        color: Colors.blue[300]!,
        imagePath: data['player1Image'] ?? '',
      ),
      Player(
        id: 'p2',
        displayName: data['player2Name'] ?? 'Player 2',
        color: Colors.green[300]!,
        imagePath: data['player2Image'] ?? '',
      ),
    ];
  }

  // Get board state for a game
  Stream<DocumentSnapshot> getBoardState(String gameId) {
    return _firestore
        .collection('game_sessions')
        .doc(gameId)
        .collection('board_state')
        .doc('current')
        .snapshots();
  }

  // Get session statistics
  Future<Map<String, dynamic>> getSessionStats(String gameId) async {
    try {
      final movesSnapshot = await _firestore
          .collection('game_sessions')
          .doc(gameId)
          .collection('moves')
          .get();

      final moves = movesSnapshot.docs;
      final remainingLetters = 100 - moves.length * 7; // Approximate

      return {
        'totalMoves': moves.length,
        'remainingLetters': remainingLetters > 0 ? remainingLetters : 0,
        'player1Score': moves
            .where((m) => m.data()['playerId'] == 'p1')
            .fold(0, (sum, m) => sum + (m.data()['score'] as int)),
        'player2Score': moves
            .where((m) => m.data()['playerId'] == 'p2')
            .fold(0, (sum, m) => sum + (m.data()['score'] as int)),
      };
    } catch (e) {
      print('Error getting session stats: $e');
      rethrow;
    }
  }

  // Get player score
  Stream<int> getPlayerScore(String gameId, String playerId) {
    return _firestore
        .collection('game_sessions')
        .doc(gameId)
        .collection('moves')
        .where('playerId', isEqualTo: playerId)
        .snapshots()
        .map((snapshot) => snapshot.docs
            .fold(0, (sum, doc) => sum + (doc.data()['score'] as int? ?? 0)));
  }

  // Get remaining letters
  Future<Map<String, int>> getRemainingLetters(String gameId) async {
    final doc = await _firestore
        .collection('game_sessions')
        .doc(gameId)
        .collection('game_state')
        .doc('letters')
        .get();

    if (!doc.exists) {
      return {}; // Return empty map if no letter data exists
    }

    final data = doc.data() as Map<String, dynamic>;
    return Map<String, int>.from(data['distribution'] ?? {});
  }

  // Get game session by ID
  Future<GameSession?> getSession(String gameId) async {
    final doc = await _firestore.collection('game_sessions').doc(gameId).get();

    if (!doc.exists) {
      return null;
    }

    return GameSession.fromFirestore(doc);
  }
}
```\n
\n### src/service/ai_service.dart\n
```dart
import 'package:cloud_text_to_speech/cloud_text_to_speech.dart';
import 'package:firebase_vertexai/firebase_vertexai.dart';
import 'package:oloodi_scrabble_end_user_app/src/models/move.dart';
import 'package:flutter_dotenv/flutter_dotenv.dart';

class AIService {
  late GenerativeModel _model;

  AIService() {
    _model = FirebaseVertexAI.instance
        .generativeModel(model: 'gemini-2.0-flash-exp');
    // Initialize TTS with Google provider
    TtsGoogle.init(
      apiKey: dotenv.get('GOOGLE_CLOUD_API_KEY'),
      withLogs: true, // Set to false in production
    );
  }

  Future<String> generateMoveExplanation(String playerName, Move move, int currentScore) async {
    try {
      final prompt = '''
      Explain this Scrabble move played by $playerName in a concise and engaging way:
      - Word: ${move.word}
      - Score for this move: ${move.score} points
      - Tiles placed: ${move.tiles.map((t) => '${t.letter}(${t.points})').join(', ')}
      - Current total score after this move: $currentScore points
      
      Please explain:
      1. Like you were talking directly to the player
      2. Why this is a good move
      3. How the score was calculated
      4. Any strategic implications
      Keep it brief but informative in 2 sentences maximum.
      ''';

      final response = await _model.generateContent([
        Content.multi([
          TextPart(prompt),
        ]),
      ]);

      if (response.text == null) {
        throw Exception('Empty response from Gemini');
      }

      // Clean markdown from the response for display
      final cleanedText = _cleanMarkdownText(response.text!);
      return cleanedText;
    } catch (e) {
      throw Exception('Failed to generate move explanation: $e');
    }
  }

  String _cleanMarkdownText(String markdown) {
    // Remove headers
    var cleaned = markdown.replaceAll(RegExp(r'#{1,6}\s.*\n'), '');

    // Remove bold and italic markers
    cleaned = cleaned.replaceAll(RegExp(r'\*\*|__|\*|_'), '');

    // Remove code blocks and inline code
    cleaned = cleaned.replaceAll(RegExp(r'```[\s\S]*?```'), '');
    cleaned = cleaned.replaceAll(RegExp(r'`[^`]*`'), '');

    // Remove bullet points and numbered lists
    cleaned = cleaned.replaceAll(RegExp(r'^\s*[-*+]\s+', multiLine: true), '');
    cleaned = cleaned.replaceAll(RegExp(r'^\s*\d+\.\s+', multiLine: true), '');

    // Remove links
    cleaned = cleaned.replaceAll(RegExp(r'\[([^\]]*)\]\([^\)]*\)'), r'$1');

    // Remove horizontal rules
    cleaned = cleaned.replaceAll(RegExp(r'^\s*[-*_]{3,}\s*'), '');

    // Remove extra whitespace
    cleaned = cleaned.replaceAll(RegExp(r'\s+'), ' ');

    return cleaned.trim();
  }

  Future<List<int>> convertToSpeech(String text) async {
    // Get voices
    final voicesResponse = await TtsGoogle.getVoices();
    
    //Pick an English Voice
    final voice = voicesResponse.voices
        .where((element) => element.name.startsWith('Mason'))
        .toList(growable: false)
        .first;

    TtsParamsGoogle params = TtsParamsGoogle(
        voice: voice,
        audioFormat: AudioOutputFormatGoogle.linear16,
        text: text,
        );

    final ttsResponse = await TtsGoogle.convertTts(params);

    //Get the audio bytes.
    return ttsResponse.audio.buffer.asUint8List().toList();
  }
}
```\n
\n### src/themes/app_themes.dart\n
```dart
import 'package:flutter/material.dart';

// Original
class AppTheme123445 {
  static const primaryColor = Color(0xFF1E4B5F);
  static const secondaryColor = Color(0xFF3C7A89);
  static const accentColor = Color(0xFFEBA63F);
  static const backgroundColor = Color(0xFFF5F5F5);
  
  static ThemeData get theme => ThemeData(
    primaryColor: primaryColor,
    scaffoldBackgroundColor: backgroundColor,
    appBarTheme: const AppBarTheme(
      backgroundColor: primaryColor,
      elevation: 0,
      centerTitle: false,
      iconTheme: IconThemeData(color: Colors.white),
      titleTextStyle: TextStyle(
        color: Colors.white,
        fontSize: 24,
        fontWeight: FontWeight.bold,
      ),
    ),
    bottomNavigationBarTheme: const BottomNavigationBarThemeData(
      backgroundColor: primaryColor,
      selectedItemColor: accentColor,
      unselectedItemColor: Colors.white70,
    ),
  );
}

// Modern Dark Theme
class AppTheme {
  static const primaryColor = Color(0xFF1A1A2E);
  static const secondaryColor = Color(0xFF16213E);
  static const accentColor = Color(0xFF00FF95);
  static const backgroundColor = Color(0xFF0F0F1A);
  
  static ThemeData get theme => ThemeData(
    primaryColor: primaryColor,
    scaffoldBackgroundColor: backgroundColor,
    appBarTheme: const AppBarTheme(
      backgroundColor: primaryColor,
      elevation: 0,
      centerTitle: false,
      iconTheme: IconThemeData(color: accentColor),
      titleTextStyle: TextStyle(
        color: Colors.white,
        fontSize: 24,
        fontWeight: FontWeight.bold,
      ),
    ),
    bottomNavigationBarTheme: const BottomNavigationBarThemeData(
      backgroundColor: primaryColor,
      selectedItemColor: accentColor,
      unselectedItemColor: Colors.white54,
    ),
  );
}

// Minimal Light theme 
class AppTheme12345 {
  static const primaryColor = Color(0xFFF8F9FA);
  static const secondaryColor = Color(0xFFE9ECEF);
  static const accentColor = Color(0xFF6C63FF);
  static const backgroundColor = Colors.white;
  
  static ThemeData get theme => ThemeData(
    primaryColor: primaryColor,
    scaffoldBackgroundColor: backgroundColor,
    appBarTheme: const AppBarTheme(
      backgroundColor: primaryColor,
      elevation: 0,
      centerTitle: false,
      iconTheme: IconThemeData(color: accentColor),
      titleTextStyle: TextStyle(
        color: Color(0xFF2D3436),
        fontSize: 24,
        fontWeight: FontWeight.bold,
      ),
    ),
    bottomNavigationBarTheme: const BottomNavigationBarThemeData(
      backgroundColor: primaryColor,
      selectedItemColor: accentColor,
      unselectedItemColor: Color(0xFF95A5A6),
    ),
  );
}

// Natue-inspired Theme
class AppTheme1234 {
  static const primaryColor = Color(0xFF2D5A27);
  static const secondaryColor = Color(0xFF4A8B3C);
  static const accentColor = Color(0xFFFFC857);
  static const backgroundColor = Color(0xFFF7F7F2);
  
  static ThemeData get theme => ThemeData(
    primaryColor: primaryColor,
    scaffoldBackgroundColor: backgroundColor,
    appBarTheme: const AppBarTheme(
      backgroundColor: primaryColor,
      elevation: 0,
      centerTitle: false,
      iconTheme: IconThemeData(color: Colors.white),
      titleTextStyle: TextStyle(
        color: Colors.white,
        fontSize: 24,
        fontWeight: FontWeight.bold,
      ),
    ),
    bottomNavigationBarTheme: const BottomNavigationBarThemeData(
      backgroundColor: primaryColor,
      selectedItemColor: accentColor,
      unselectedItemColor: Colors.white70,
    ),
  );
}
```\n
\n### src/widgets/player_history_sheet.dart\n
```dart
import 'package:flutter/material.dart';
import 'package:oloodi_scrabble_end_user_app/src/models/player.dart';
import 'package:intl/intl.dart';
import 'package:oloodi_scrabble_end_user_app/src/providers/game_state_provider.dart';
import 'package:provider/provider.dart';

class PlayerHistorySheet extends StatelessWidget {
  final Player player;

  const PlayerHistorySheet({
    super.key,
    required this.player,
  });

  @override
  Widget build(BuildContext context) {
    return Container(
      padding: const EdgeInsets.all(16),
      child: Column(
        crossAxisAlignment: CrossAxisAlignment.start,
        mainAxisSize: MainAxisSize.min,
        children: [
          Row(
            children: [
              Container(
                width: 24,
                height: 24,
                decoration: BoxDecoration(
                  color: player.color,
                  shape: BoxShape.circle,
                ),
              ),
              const SizedBox(width: 8),
              Text(
                '${player.displayName}\'s Moves',
                style: Theme.of(context).textTheme.titleLarge,
              ),
            ],
          ),
          const SizedBox(height: 16),
          Expanded(
            child: Consumer<GameStateProvider>(
              builder: (context, gameState, child) {
                final moves = gameState.getMovesByPlayer(player.id);
                return ListView.builder(
                  itemCount: moves.length,
                  itemBuilder: (context, index) {
                    final move = moves[index];
                    return Card(
                      child: ListTile(
                        leading: CircleAvatar(
                          backgroundColor: player.color,
                          child: Text(
                            move.word[0],
                            style: const TextStyle(color: Colors.white),
                          ),
                        ),
                        title: Text(move.word),
                        subtitle: Text(
                          'Score: ${move.score} points',
                        ),
                        trailing: Text(
                          DateFormat.jm().format(move.timestamp),
                        ),
                      ),
                    );
                  },
                );
              },
            ),
          ),
        ],
      ),
    );
  }
}```\n
\n### src/widgets/move_history_panel.dart\n
```dart
import 'package:flutter/material.dart';
import 'package:oloodi_scrabble_end_user_app/src/providers/game_state_provider.dart';
import 'package:provider/provider.dart';

class MoveHistoryPanel extends StatelessWidget {
  const MoveHistoryPanel({super.key});

  @override
  Widget build(BuildContext context) {
    return Consumer<GameStateProvider>(
      builder: (context, gameState, child) {
        final distribution = gameState.letterDistribution;

        return Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            Container(
              padding: const EdgeInsets.all(16),
              decoration: BoxDecoration(
                color: Theme.of(context).colorScheme.surface,
                border: Border(
                  bottom: BorderSide(
                    color: Theme.of(context).dividerColor,
                  ),
                ),
              ),
              child: Row(
                mainAxisAlignment: MainAxisAlignment.spaceBetween,
                children: [
                  const Text(
                    'Move History',
                    style: TextStyle(
                      fontSize: 20,
                      fontWeight: FontWeight.bold,
                    ),
                  ),
                  Tooltip(
                    message: distribution.entries
                        .where((e) => e.value > 0)
                        .map((e) => '${e.key}: ${e.value}')
                        .join('\n'),
                    child: Text(
                      'Remaining: ${gameState.remainingLetters}',
                      style: const TextStyle(
                        fontWeight: FontWeight.bold,
                      ),
                    ),
                  ),
                ],
              ),
            ),
            Expanded(
              child: ListView.builder(
                itemCount: gameState.moves.length,
                itemBuilder: (context, index) {
                  final move = gameState.moves[index];
                  final player = gameState.players.firstWhere(
                    (p) => p.id == move.playerId,
                  );

                  return ListTile(
                    leading: CircleAvatar(
                      backgroundColor: player.color,
                      child: Text(
                        move.word[0],
                        style: const TextStyle(color: Colors.white),
                      ),
                    ),
                    title: Text(move.word),
                    subtitle:
                        Text('${player.displayName} - ${move.score} points'),
                    trailing: Text(
                      '${index + 1}',
                      style: Theme.of(context).textTheme.bodySmall,
                    ),
                  );
                },
              ),
            ),
          ],
        );
      },
    );
  }
}
```\n
\n### src/widgets/move_explanation_controls.dart\n
```dart
import 'dart:typed_data';

import 'package:flutter/material.dart';
import 'package:audioplayers/audioplayers.dart';
import '../models/move_explanation.dart';
import '../themes/app_themes.dart';

class MoveExplanationControls extends StatefulWidget {
  final MoveExplanation explanation;
  final VoidCallback onClose;

  const MoveExplanationControls({
    super.key,
    required this.explanation,
    required this.onClose,
  });

  @override
  State<MoveExplanationControls> createState() => _MoveExplanationControlsState();
}

class _MoveExplanationControlsState extends State<MoveExplanationControls> {
  late AudioPlayer _audioPlayer;
  bool _isPlaying = false;
  Duration _duration = Duration.zero;
  Duration _position = Duration.zero;

  @override
  void initState() {
    super.initState();
    _initAudioPlayer();
  }

  void _initAudioPlayer() {
    _audioPlayer = AudioPlayer();
    
    _audioPlayer.onDurationChanged.listen((duration) {
      if (mounted) setState(() => _duration = duration);
    });

    _audioPlayer.onPositionChanged.listen((position) {
      if (mounted) setState(() => _position = position);
    });

    _audioPlayer.onPlayerComplete.listen((_) {
      if (mounted) {
        setState(() {
          _isPlaying = false;
          _position = Duration.zero;
        });
      }
    });
  }

  Future<void> _playPause() async {
    if (widget.explanation.audioData == null) return;

    if (_isPlaying) {
      await _audioPlayer.pause();
    } else {
      if (_position == Duration.zero) {
     await _audioPlayer.play(BytesSource(Uint8List.fromList(widget.explanation.audioData!)));
      } else {
        await _audioPlayer.resume();
      }
    }
    
    setState(() => _isPlaying = !_isPlaying);
  }

  Future<void> _seekTo(Duration position) async {
    await _audioPlayer.seek(position);
    setState(() => _position = position);
  }

  String _formatDuration(Duration duration) {
    String twoDigits(int n) => n.toString().padLeft(2, '0');
    final minutes = twoDigits(duration.inMinutes.remainder(60));
    final seconds = twoDigits(duration.inSeconds.remainder(60));
    return '$minutes:$seconds';
  }

  @override
  void dispose() {
    _audioPlayer.dispose();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    return Container(
      margin: const EdgeInsets.symmetric(horizontal: 16, vertical: 8),
      padding: const EdgeInsets.all(12),
      decoration: BoxDecoration(
        color: AppTheme.primaryColor.withOpacity(0.1),
        borderRadius: BorderRadius.circular(8),
        border: Border.all(
          color: AppTheme.accentColor.withOpacity(0.3),
          width: 1,
        ),
      ),
      child: Column(
        mainAxisSize: MainAxisSize.min,
        children: [
          Row(
            children: [
              IconButton(
                icon: Icon(
                  _isPlaying ? Icons.pause_circle : Icons.play_circle,
                  color: AppTheme.accentColor,
                  size: 32,
                ),
                onPressed: _playPause,
              ),
              const SizedBox(width: 8),
              Expanded(
                child: Column(
                  crossAxisAlignment: CrossAxisAlignment.start,
                  children: [
                    Text(
                      'Move Explanation',
                      style: TextStyle(
                        color: AppTheme.accentColor,
                        fontWeight: FontWeight.bold,
                      ),
                    ),
                    const SizedBox(height: 4),
                    Row(
                      children: [
                        Text(
                          _formatDuration(_position),
                          style: const TextStyle(
                            color: Colors.white70,
                            fontSize: 12,
                          ),
                        ),
                        Expanded(
                          child: SliderTheme(
                            data: SliderTheme.of(context).copyWith(
                              trackHeight: 2,
                              thumbShape: const RoundSliderThumbShape(
                                enabledThumbRadius: 6,
                              ),
                              overlayShape: const RoundSliderOverlayShape(
                                overlayRadius: 14,
                              ),
                              activeTrackColor: AppTheme.accentColor,
                              inactiveTrackColor: Colors.white24,
                              thumbColor: AppTheme.accentColor,
                              overlayColor: AppTheme.accentColor.withOpacity(0.2),
                            ),
                            child: Slider(
                              min: 0,
                              max: _duration.inMilliseconds.toDouble(),
                              value: _position.inMilliseconds.toDouble(),
                              onChanged: (value) {
                                _seekTo(Duration(milliseconds: value.toInt()));
                              },
                            ),
                          ),
                        ),
                        Text(
                          _formatDuration(_duration),
                          style: const TextStyle(
                            color: Colors.white70,
                            fontSize: 12,
                          ),
                        ),
                      ],
                    ),
                  ],
                ),
              ),
              const SizedBox(width: 8),
              IconButton(
                icon: const Icon(Icons.close),
                onPressed: () {
                  _audioPlayer.stop();
                  widget.onClose();
                },
                color: Colors.white70,
              ),
            ],
          ),
          const SizedBox(height: 8),
          Text(
            widget.explanation.text,
            style: const TextStyle(color: Colors.white70),
          ),
        ],
      ),
    );
  }
}```\n
\n### src/widgets/player_score_card.dart\n
```dart
import 'package:flutter/material.dart';
import 'package:oloodi_scrabble_end_user_app/src/models/player.dart';
import 'package:oloodi_scrabble_end_user_app/src/themes/app_themes.dart';
class PlayerScoreCard extends StatelessWidget {
  final Player player;
  final int score;
  final bool isCurrentPlayer;

  const PlayerScoreCard({
    super.key,
    required this.player,
    required this.score,
    required this.isCurrentPlayer,
  });

  @override
  Widget build(BuildContext context) {
    return Container(
      padding: const EdgeInsets.all(12),
      decoration: BoxDecoration(
        color: Colors.white.withOpacity(0.1),
        borderRadius: BorderRadius.circular(8),
        border: Border.all(
          color: isCurrentPlayer ? AppTheme.accentColor : Colors.transparent,
          width: 2,
        ),
      ),
      child: Row(
        children: [
          // Player image
          Container(
            width: 48,
            height: 48,
            decoration: BoxDecoration(
              shape: BoxShape.circle,
              border: Border.all(
                color: AppTheme.accentColor,
                width: 2,
              ),
            ),
            child: ClipOval(
              child: Image.asset(
                player.imagePath,
                fit: BoxFit.cover,
                errorBuilder: (context, error, stackTrace) {
                  return Container(
                    color: Colors.white24,
                    child: const Icon(
                      Icons.person,
                      color: Colors.white,
                      size: 24,
                    ),
                  );
                },
              ),
            ),
          ),
          const SizedBox(width: 12),
          Expanded(
            child: Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                Text(
                  player.displayName,
                  style: const TextStyle(
                    color: Colors.white,
                    fontWeight: FontWeight.bold,
                    fontSize: 14,
                  ),
                ),
                const SizedBox(height: 4),
                Text(
                  'Score: $score',
                  style: TextStyle(
                    color: AppTheme.accentColor,
                    fontSize: 16,
                    fontWeight: FontWeight.bold,
                  ),
                ),
              ],
            ),
          ),
        ],
      ),
    );
  }
}```\n
\n### src/widgets/board_widget.dart\n
```dart
// lib/widgets/board_widget.dart
import 'package:flutter/material.dart';
import 'package:provider/provider.dart';
import '../providers/game_state_provider.dart';
import '../models/board_square.dart';
import '../models/tile.dart';
// lib/widgets/board_widget.dart
class BoardWidget extends StatefulWidget {
  const BoardWidget({super.key});

  @override
  State<BoardWidget> createState() => _BoardWidgetState();
}

class _BoardWidgetState extends State<BoardWidget> {
  double _scale = 1.0;
  Offset _offset = Offset.zero;
  late TransformationController _transformationController;

  @override
  void initState() {
    super.initState();
    _transformationController = TransformationController();
  }

  @override
  void dispose() {
    _transformationController.dispose();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    return GestureDetector(
      onScaleStart: (details) {
        _scale = _transformationController.value.getMaxScaleOnAxis();
        _offset = details.focalPoint;
      },
      onScaleUpdate: (details) {
        final newScale = (_scale * details.scale).clamp(0.8, 2.0);
        final focalPoint = details.focalPoint;
        _transformationController.value = Matrix4.identity()
          ..translate(focalPoint.dx - _offset.dx, focalPoint.dy - _offset.dy)
          ..scale(newScale);
      },
      child: InteractiveViewer(
        transformationController: _transformationController,
        minScale: 0.8,
        maxScale: 2.0,
        child: Consumer<GameStateProvider>(
          builder: (context, gameState, child) {
            return AspectRatio(
              aspectRatio: 1,
              child: GridView.builder(
                physics: const NeverScrollableScrollPhysics(),
                gridDelegate: const SliverGridDelegateWithFixedCrossAxisCount(
                  crossAxisCount: 15,
                  childAspectRatio: 1,
                ),
                itemCount: 225,
                itemBuilder: (context, index) {
                  final row = index ~/ 15;
                  final col = index % 15;
                  final square = gameState.board[row][col];
                  
                  return _buildSquare(square, gameState);
                },
              ),
            );
          },
        ),
      ),
    );
  }

  Widget _buildSquare(BoardSquare square, GameStateProvider gameState) {
    return Container(
      decoration: BoxDecoration(
        border: Border.all(color: Colors.black12),
        color: _getSquareColor(square.type),
      ),
      child: square.tile != null
          ? _buildTile(square.tile!, gameState)
          : _buildSquareContent(square.type),
    );
  }
Widget _buildTile(Tile tile, GameStateProvider gameState) {
    final player = gameState.players.firstWhere(
      (p) => p.id == tile.playerId,
      orElse: () => gameState.players[0],
    );

    return AnimatedScale(
      scale: tile.isNew ? 0.0 : 1.0,
      duration: const Duration(milliseconds: 500),
      curve: Curves.elasticOut,
      child: AnimatedRotation(
        turns: tile.isNew ? -0.5 : 0,
        duration: const Duration(milliseconds: 500),
        curve: Curves.elasticOut,
        child: Container(
          margin: const EdgeInsets.all(1),
          decoration: BoxDecoration(
            color: const Color(0xFFF7D698),
            borderRadius: BorderRadius.circular(4),
            boxShadow: [
              BoxShadow(
                color: Colors.black.withOpacity(0.2),
                blurRadius: 2,
                offset: const Offset(1, 1),
              ),
            ],
            border: Border.all(
              color: player.color,
              width: 2,
            ),
          ),
          child: Stack(
            fit: StackFit.expand,
            children: [
              // Letter - left aligned
              Positioned(
                left: 4,
                top: 0,
                bottom: 0,
                child: Center(
                  child: Text(
                    tile.letter,
                    style: const TextStyle(
                      fontSize: 13,
                      fontWeight: FontWeight.bold,
                      color: Colors.black87,
                    ),
                  ),
                ),
              ),
              // Points - right aligned
              Positioned(
                right: 2,
                bottom: 1,
                child: Text(
                  '${tile.points}',
                  style: const TextStyle(
                    fontSize: 7,
                    fontWeight: FontWeight.bold,
                    color: Colors.black54,
                  ),
                ),
              ),
            ],
          ),
        ),
      ),
    );
  }

  Widget _buildSquareContent(SquareType type) {
    String label = '';
    switch (type) {
      case SquareType.tripleWord:
        label = 'TW';
        break;
      case SquareType.doubleWord:
        label = 'DW';
        break;
      case SquareType.tripleLetter:
        label = 'TL';
        break;
      case SquareType.doubleLetter:
        label = 'DL';
        break;
      case SquareType.center:
        label = '★';
        break;
      default:
        return const SizedBox();
    }

    return Center(
      child: Text(
        label,
        style: TextStyle(
          fontSize: 10,
          fontWeight: FontWeight.bold,
          color: _getSquareColor(type).computeLuminance() > 0.5
              ? Colors.black54
              : Colors.white70,
        ),
      ),
    );
  }

  Color _getSquareColor(SquareType type) {
    switch (type) {
      case SquareType.tripleWord:
        return Colors.red[100]!;
      case SquareType.doubleWord:
        return Colors.pink[50]!;
      case SquareType.tripleLetter:
        return Colors.blue[100]!;
      case SquareType.doubleLetter:
        return Colors.lightBlue[50]!;
      case SquareType.center:
        return Colors.pink[50]!;
      default:
        return Colors.white;
    }
  }
}```\n
\n## pubspec.yaml\n
```yaml
name: oloodi_scrabble_end_user_app
description: A dynamic Scrabble AI app that enhances the traditional Scrabble game experience using Flutter and Gemini SDK.

# The following line prevents the package from being accidentally published to
# pub.dev using `flutter pub publish`. This is preferred for private packages.
publish_to: 'none'

# Version number
version: 1.0.0+1

environment:
  sdk: '>=3.0.0 <4.0.0'

# Dependencies specify other packages that your package needs in order to work.
dependencies:
  flutter:
    sdk: flutter
  
  # UI and Core
  cupertino_icons: ^1.0.2
  google_fonts: ^6.1.0
  flutter_svg: ^2.0.9
  
  # State Management
  provider: ^6.1.1
  
  # Camera and Image Processing
  camera: ^0.10.5+9
  image_picker: ^1.0.7
  path_provider: ^2.1.2
  path: ^1.8.3
  
  # Animations
  animations: ^2.0.11
  flutter_animate: ^4.5.0
  
  # Gemini SDK
  google_generative_ai: ^0.2.0
  
  # Storage and Database
  shared_preferences: ^2.2.2
  sqflite: ^2.3.2
  
  # Utils
  intl: ^0.20.2
  logger: ^2.0.2+1
  uuid: ^4.3.3
  
  # Network and API
  http: ^1.2.0
  connectivity_plus: ^5.0.2
  firebase_core: ^3.10.1
  cloud_firestore: ^5.6.2
  firebase_auth: ^5.4.1
  json_annotation: ^4.9.0
  firebase_storage: ^12.4.1
  firebase_vertexai: ^1.1.1
  audioplayers: ^6.1.1
  cloud_text_to_speech: ^1.1.3
  flutter_dotenv: ^5.2.1

dev_dependencies:
  flutter_test:
    sdk: flutter
    
  # Development Tools
  flutter_lints: ^3.0.1
  build_runner: ^2.4.13
  mockito: ^5.4.4
  flutter_launcher_icons: ^0.13.1
  flutter_native_splash: ^2.3.10
  json_serializable: ^6.9.0

# Flutter configuration
flutter:
  uses-material-design: true
  
  # Assets
  assets:
    - assets/images/
    - .env

# Flutter Launcher Icons configuration (customize as needed)
flutter_launcher_icons:
  android: "launcher_icon"
  ios: true
  image_path: "assets/icons/app_icon.png"
  min_sdk_android: 21
  adaptive_icon_background: "#FFFFFF"
  adaptive_icon_foreground: "assets/icons/app_icon_foreground.png"

# Flutter Native Splash configuration (customize as needed)
flutter_native_splash:
  color: "#FFFFFF"
  image: assets/images/splash.png
  android_12:
    image: assets/images/splash.png
    color: "#FFFFFF"
  ios: true
```
